/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var E=(g,a)=>{for(var t in a)f(g,t,{get:a[t],enumerable:!0})},x=(g,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of k(a))!C.call(g,s)&&s!==t&&f(g,s,{get:()=>a[s],enumerable:!(e=v(a,s))||e.enumerable});return g};var L=g=>x(f({},"__esModule",{value:!0}),g);var D={};E(D,{default:()=>d});module.exports=L(D);var c=require("obsidian"),P={propertyKey:"title"},m=class extends c.EditorSuggest{constructor(t){super(t.app);this.plugin=t}open(){super.open();let t=this.suggestEl;if(t&&!t.querySelector(".prompt-instructions")){let e=t.createDiv({cls:"prompt-instructions"});e.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),e.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),e.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}}onTrigger(t,e,s){let i=e.getLine(t.line).substring(0,t.ch),n=/\[\[([^#^|\]]+)$/.exec(i);return n?{start:{line:t.line,ch:i.lastIndexOf("[[")},end:t,query:n[1]}:null}getSuggestions(t){let e=t.query.trim(),s=[],i=new Set;return this.app.vault.getMarkdownFiles().forEach(n=>{let o=this.app.metadataCache.getFileCache(n),r=o==null?void 0:o.frontmatter,p=n.basename,l=!1;if(r&&r[this.plugin.settings.propertyKey]!==void 0&&r[this.plugin.settings.propertyKey]!==null){let u=String(r[this.plugin.settings.propertyKey]).trim();u!==""&&(p=u,l=!0)}(this.fuzzyMatch(p,t.query)||this.fuzzyMatch(n.basename,t.query))&&(s.push({file:n,display:p,isCustomDisplay:l}),i.add(n.basename.toLowerCase()))}),e&&!i.has(e.toLowerCase())&&s.unshift({display:e,isCustomDisplay:!1,isNewNote:!0}),this.sortSuggestions(s,e)}fuzzyMatch(t,e){let s=0,i=t.toLowerCase(),n=e.toLowerCase();for(let o of n)if(s=i.indexOf(o,s)+1,s===0)return!1;return!0}sortSuggestions(t,e){return t.sort((s,i)=>{var r,p,l,u;let n=this.getMatchScore(s.display,e,(p=(r=s.file)==null?void 0:r.basename)!=null?p:""),o=this.getMatchScore(i.display,e,(u=(l=i.file)==null?void 0:l.basename)!=null?u:"");return s.isNewNote?-1:i.isNewNote?1:o-n||s.display.localeCompare(i.display)})}getMatchScore(t,e,s){let i=0,n=t.toLowerCase(),o=s.toLowerCase(),r=e.toLowerCase();return n.startsWith(r)?i+=10:n.includes(r)&&(i+=5),o.startsWith(r)?i+=8:o.includes(r)&&(i+=4),i}renderSuggestion(t,e){e.empty();let s=e.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title",text:t.display}),t.file&&s.createDiv({cls:"suggestion-note",text:t.file.path.replace(".md","")})}async selectSuggestion(t,e){var w;let s=this.app.workspace.getActiveViewOfType(c.MarkdownView);if(!s||!this.context)return;let i=s.editor,{start:n,end:o}=this.context,r=i.getLine(o.line),p=(w=this.app.vault.getConfig("useMarkdownLinks"))!=null?w:!1,l;if(t.isNewNote){let y=await this.app.vault.create(`${t.display}.md`,"");l=p?`[${t.display}](${encodeURI(y.path)})`:`[[${y.basename}]]`}else p?l=`[${t.display}](${encodeURI(t.file.path)})`:l=`[[${t.file.basename}|${t.display}]]`;let u={line:n.line,ch:n.ch},T={line:o.line,ch:r.length};i.replaceRange(l,u,T);let h={line:o.line,ch:n.ch+l.length};i.setCursor(h),i.setSelection(h,h)}},d=class extends c.Plugin{async onload(){await this.loadSettings(),this.suggest=new m(this);let t=this.app.workspace.editorSuggest;t&&(t.suggests=t.suggests.filter(e=>!e.constructor.name.includes("LinkSuggest")),t.suggests.unshift(this.suggest)),this.registerEditorSuggest(this.suggest),this.addSettingTab(new S(this.app,this))}onunload(){let t=this.app.workspace.editorSuggest;t&&(t.suggests=t.suggests.filter(e=>e!==this.suggest))}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},S=class extends c.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName("Property key").setDesc('The frontmatter property to use as the display title (e.g., "title" or "display_title").').addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async s=>{this.plugin.settings.propertyKey=s||"title",await this.plugin.saveSettings()}))}};
