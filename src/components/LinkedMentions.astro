---
import type { Post, LinkedMention } from '@/types';
import { findLinkedMentions } from '@/utils/wikilinks';
import { getCollection } from 'astro:content';

export interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;

// Get all posts to find linked mentions
const posts = await getCollection('posts');
const linkedMentions = findLinkedMentions(posts, currentSlug);
---

{linkedMentions.length > 0 && (
  <section class="mt-12 pt-8 border-t border-primary-200 dark:border-primary-700">
    <h2 class="text-xl font-semibold text-primary-900 dark:text-primary-50 mb-6 flex items-center">
      <i data-lucide="link-2" class="w-5 h-5 mr-2"></i>
      Linked Mentions
      <span class="ml-2 text-sm font-normal text-primary-500 dark:text-primary-400">
        ({linkedMentions.length})
      </span>
    </h2>
    
    <div class="space-y-4">
      {linkedMentions.map(mention => (
        <article class="p-4 bg-primary-50 dark:bg-primary-800/30 rounded-lg border border-primary-200 dark:border-primary-700 hover:border-primary-300 dark:hover:border-primary-600 transition-colors">
          <h3 class="font-medium text-primary-900 dark:text-primary-50 mb-2">
            <a 
              href={`/posts/${mention.slug}`}
              class="hover:text-highlight-600 dark:hover:text-highlight-400 transition-colors"
            >
              {mention.title}
            </a>
          </h3>
          
          {mention.excerpt && (
            <p class="text-sm text-primary-600 dark:text-primary-300 leading-relaxed">
              ...{mention.excerpt}...
            </p>
          )}
          
          <div class="mt-3 flex items-center text-xs text-primary-500 dark:text-primary-400">
            <i data-lucide="arrow-right" class="w-3 h-3 mr-1"></i>
            <span>Referenced in this post</span>
          </div>
        </article>
      ))}
    </div>
    
    <div class="mt-6 p-4 bg-highlight-50 dark:bg-highlight-900/20 rounded-lg border border-highlight-200 dark:border-highlight-800">
      <div class="flex items-start space-x-3">
        <i data-lucide="info" class="w-5 h-5 text-highlight-600 dark:text-highlight-400 mt-0.5 flex-shrink-0"></i>
        <div class="text-sm">
          <p class="text-highlight-800 dark:text-highlight-200 font-medium mb-1">
            About Linked Mentions
          </p>
          <p class="text-highlight-700 dark:text-highlight-300">
            These are posts that reference this article using wikilinks. This creates a network of interconnected content, similar to Obsidian's linking system.
          </p>
        </div>
      </div>
    </div>
  </section>
)}

<style>
  /* Enhanced styling for linked mentions */
  .linked-mention-item {
    position: relative;
  }
  
  .linked-mention-item::before {
    content: '';
    position: absolute;
    left: -1rem;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(to bottom, rgb(14 165 233), rgb(59 130 246));
    border-radius: 2px;
    opacity: 0.3;
  }
  
  .linked-mention-item:hover::before {
    opacity: 1;
  }
</style>
